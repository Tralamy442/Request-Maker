<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="style.css">
	<link rel="stylesheet" href="res/font-awesome-offline/css/all.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.5/ace.js" type="text/javascript" charset="utf-8">
	</script>
	<script src="js/fap.js"></script>
	<title>Tralamy App</title>

	<style type="text/css" media="screen">
	</style>
</head>

<body>
	<script>
		window.$ = window.jQuery = require('jquery');
	</script>
	<section class="main">
		<h1 class="title">Request Maker</h1>

		<div class="mainInput">
			<select name="get_post" id="getOrPost" class="combobox">
				<option value="get">Get</option>
				<option value="post">Post</option>
			</select>
			<input type="text" name="url" id="urlInput" class="urlInput" placeholder="Url">
		</div>

		<div class="paramMain">
			<div class="param">
				<!-- Query -->
				<div class="query param-main">
					<div id="allQueryInput"></div>

					<button onclick="addQuery()" class="add-btn addQuery-btn"
						data-title="Control + Click to delete last">
						<i class="fad fa-plus"></i>
						<p>Query</p>
					</button>
				</div>

				<!-- Header -->
				<div class="header param-main">
					<!--  -->

					<div id="allHeadersInputs"></div>

					<button onclick="addHeader()" class="add-btn addHeader-btn"
						data-title="Control + Click to delete last">
						<i class="fad fa-plus"></i>
						<p>Header</p>
					</button>
				</div>
			</div>

		</div>

		<!-- Request Button -->
		<button onclick="makeRequest()" class="request-btn">
			<p>Request</p>
			<i class="fad fa-search"></i>
		</button>

	</section>

	<section class="result">
		<div class="resultBackground">
			<pre class="resultText">
				<code  id="finalResult"> 
{
	"message" : "Try it! Make a request ðŸ˜œ!"
}
				</code>
  			</pre>
		</div>
	</section>

	<script lang="js">
		$(document).keydown(function (event) {
			if (event.which == "17")
				cntrlIsPressed = true;
		});

		$(document).keyup(function () {
			cntrlIsPressed = false;
		});

		var cntrlIsPressed = false;

		var editor = ace.edit("finalResult");
		editor.setTheme("ace/theme/chrome");
		editor.session.setMode("ace/mode/json");
		editor.setReadOnly(true);
		editor.setShowPrintMargin(false);


		var unirest = require("unirest");

		var totalQuery = 0;
		var totalHeader = 0;

		function makeRequest() {

			console.log(totalQuery, totalHeader);

			var urlInput = document.getElementById('urlInput').value;
			var getOrPost = document.getElementById('getOrPost').value.toUpperCase();

			if (totalQuery > 0) urlInput += "?";

			/* Query */
			for (let i = 0; i < totalQuery; i++) {
				var key = document.querySelector('#queryKey' + i).value;
				var value = document.querySelector('#queryValue' + i).value;
				key += "=";

				let input = key + value;

				if (i != totalQuery - 1) input += '&';
				urlInput += input; // value+key
			}

			var req = unirest(getOrPost, urlInput);

			/* Headers */
			for (let i = 0; i < totalHeader; i++) {
				console.log("Work");
				var key = document.querySelector('#headerKey' + i).value;
				var value = document.querySelector('#headerValue' + i).value;
				console.log('#headerKey' + i);
				req.headers(key, value);
				console.log(key + " : " + value);
			}

			req.end(function (res) {
				if (res.error) throw new Error(res.error);

				let jsonText = JSON.stringify(res.body, null, '\t')
				editor.setValue(jsonText);
			});

		}

		function addQuery() {
			const divContainer = document.querySelector('#allQueryInput');
			if(cntrlIsPressed) {
				divContainer.removeChild(divContainer.lastChild);
				return;
			}
			var mainDiv = document.createElement("div");
			mainDiv.className = "key_value";

			var keyInput = document.createElement("input");
			keyInput.type = "text";
			keyInput.name = "queryKey" + totalQuery;
			keyInput.id = "queryKey" + totalQuery;
			keyInput.className = "add-input addKey addQuery-input";
			keyInput.placeholder = "Key";

			var valueInput = document.createElement("input");
			valueInput.type = "text";
			valueInput.name = "queryValue" + totalQuery;
			valueInput.id = "queryValue" + totalQuery;
			valueInput.className = "add-input addValue addQuery-input";
			valueInput.placeholder = "Value";

			mainDiv.appendChild(keyInput);
			mainDiv.appendChild(valueInput);

			divContainer.appendChild(mainDiv);
			totalQuery++;
		}

		function addHeader() {
			const divContainer = document.querySelector('#allHeadersInputs');
			if(cntrlIsPressed) {
				divContainer.removeChild(divContainer.lastChild);
				return;
			}
			var mainDiv = document.createElement("div");
			mainDiv.className = "key_value";

			var keyInput = document.createElement("input");
			keyInput.type = "text";
			keyInput.name = "headerKey" + totalHeader;
			keyInput.id = "headerKey" + totalHeader;
			keyInput.className = "add-input addKey addheader-input";
			keyInput.placeholder = "Key";

			var valueInput = document.createElement("input");
			valueInput.type = "text";
			valueInput.name = "headerValue" + totalHeader;
			valueInput.id = "headerValue" + totalHeader;
			valueInput.className = "add-input addValue addheader-input";
			valueInput.placeholder = "Value";

			mainDiv.appendChild(keyInput);
			mainDiv.appendChild(valueInput);

			divContainer.appendChild(mainDiv);
			totalHeader++;
		}
	</script>
</body>

</html>